extends layout

block content
    script(src="/javascripts/utils.js")
    h1= title
    p Authorization page
    a(href=`${dropbox.auth.getAuthenticationUrl('http://localhost:3000/users/auth')}`) 
        button click me

    script. 
        const setCookie = async (cookie) => {
            const response = await fetch('http://localhost:3000/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }, 
                body: JSON.stringify(cookie)
            })
            
            return response.json()
        }

        let token = utils.parseQueryString(location.hash).access_token

        if (token) {
            const cookie = {
                name: 'dbx-token',
                value: token
            }
              
            setCookie(cookie)
                .then((response) => {
                    console.log(response)
                })
                .catch((error) => {
                    console.log(error)
                })
        } 
